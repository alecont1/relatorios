---
phase: 03-multi-tenant-architecture
plan: 05
type: execute
wave: 3
depends_on: ["03-03", "03-04"]
files_modified:
  - frontend/src/features/tenant/types.ts
  - frontend/src/features/tenant/api.ts
  - frontend/src/features/tenant/store.ts
  - frontend/src/features/tenant/hooks/useTheme.ts
  - frontend/src/features/tenant/index.ts
  - frontend/src/features/tenant/components/TenantList.tsx
  - frontend/src/features/tenant/components/CreateTenantModal.tsx
  - frontend/src/features/tenant/components/TenantSettingsForm.tsx
  - frontend/src/features/tenant/components/LogoUploader.tsx
  - frontend/src/features/tenant/components/ColorPicker.tsx
  - frontend/src/features/tenant/components/index.ts
  - frontend/src/pages/TenantsPage.tsx
  - frontend/src/pages/TenantSettingsPage.tsx
  - frontend/src/pages/index.ts
  - frontend/src/App.tsx
  - frontend/package.json
  - frontend/src/index.css
autonomous: false

must_haves:
  truths:
    - "Superadmin can view list of all tenants in TenantsPage"
    - "Superadmin can create new tenant via modal"
    - "Superadmin can activate/deactivate tenant from list"
    - "Admin can access tenant settings page"
    - "Admin can change brand colors using color picker"
    - "Admin can upload primary and secondary logos"
    - "Admin can update contact information"
    - "Tenant branding (colors) applies dynamically via CSS variables"
  artifacts:
    - path: "frontend/src/features/tenant/store.ts"
      provides: "Zustand store for tenant branding state"
      exports: ["useTenantStore"]
    - path: "frontend/src/features/tenant/hooks/useTheme.ts"
      provides: "Hook that applies tenant colors as CSS variables"
      exports: ["useTheme"]
    - path: "frontend/src/pages/TenantsPage.tsx"
      provides: "Superadmin tenant management page"
      min_lines: 50
    - path: "frontend/src/pages/TenantSettingsPage.tsx"
      provides: "Admin tenant branding settings page"
      min_lines: 100
  key_links:
    - from: "frontend/src/features/tenant/hooks/useTheme.ts"
      to: "frontend/src/features/tenant/store.ts"
      via: "useTenantStore()"
      pattern: "useTenantStore"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/features/tenant/hooks/useTheme.ts"
      via: "useTheme()"
      pattern: "useTheme\\(\\)"
---

<objective>
Create frontend UI for tenant management (superadmin) and tenant branding settings (admin).

Purpose: Enable superadmin to manage tenants and admins to configure their organization's branding (TNNT-01 to TNNT-05).
Output: Tenant management pages, settings forms, logo upload, color picker, and dynamic theming.
</objective>

<execution_context>
@C:\Users\xande\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\xande\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-multi-tenant-architecture/03-RESEARCH.md
@.planning/phases/03-multi-tenant-architecture/03-03-SUMMARY.md
@.planning/phases/03-multi-tenant-architecture/03-04-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/features/auth/store.ts
@frontend/src/features/admin/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-colorful and create tenant feature structure</name>
  <files>frontend/package.json, frontend/src/features/tenant/types.ts, frontend/src/features/tenant/api.ts, frontend/src/features/tenant/index.ts</files>
  <action>
1. Install react-colorful:
   ```bash
   cd frontend && npm install react-colorful
   ```

2. Create frontend/src/features/tenant/types.ts:
```typescript
export interface Tenant {
  id: string
  name: string
  slug: string
  is_active: boolean
  logo_primary_key: string | null
  logo_secondary_key: string | null
  brand_color_primary: string | null
  brand_color_secondary: string | null
  brand_color_accent: string | null
  contact_address: string | null
  contact_phone: string | null
  contact_email: string | null
  contact_website: string | null
  created_at: string
  updated_at: string
}

export interface TenantsListResponse {
  tenants: Tenant[]
  total: number
}

export interface CreateTenantRequest {
  name: string
  slug: string
}

export interface UpdateTenantRequest {
  name?: string
  is_active?: boolean
}

export interface UpdateBrandingRequest {
  brand_color_primary?: string | null
  brand_color_secondary?: string | null
  brand_color_accent?: string | null
  contact_address?: string | null
  contact_phone?: string | null
  contact_email?: string | null
  contact_website?: string | null
}

export interface LogoUploadUrlRequest {
  logo_type: 'primary' | 'secondary'
  filename: string
}

export interface LogoUploadUrlResponse {
  upload_url: string
  object_key: string
}

export interface LogoConfirmRequest {
  logo_type: 'primary' | 'secondary'
  object_key: string
}
```

3. Create frontend/src/features/tenant/api.ts with React Query hooks:
```typescript
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query'
import { api } from '@/lib/axios'
import type {
  Tenant,
  TenantsListResponse,
  CreateTenantRequest,
  UpdateTenantRequest,
  UpdateBrandingRequest,
  LogoUploadUrlRequest,
  LogoUploadUrlResponse,
  LogoConfirmRequest,
} from './types'

// Superadmin: Tenant CRUD
export function useTenants(includeInactive = false) {
  return useQuery({
    queryKey: ['tenants', { includeInactive }],
    queryFn: async () => {
      const { data } = await api.get<TenantsListResponse>('/tenants', {
        params: { include_inactive: includeInactive },
      })
      return data
    },
  })
}

export function useCreateTenant() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async (tenant: CreateTenantRequest) => {
      const { data } = await api.post<Tenant>('/tenants', tenant)
      return data
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['tenants'] })
    },
  })
}

export function useUpdateTenant() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async ({ id, ...data }: UpdateTenantRequest & { id: string }) => {
      const { data: result } = await api.patch<Tenant>(`/tenants/${id}`, data)
      return result
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['tenants'] })
    },
  })
}

// Admin: Tenant Settings
export function useTenantBranding() {
  return useQuery({
    queryKey: ['tenant-branding'],
    queryFn: async () => {
      const { data } = await api.get<Tenant>('/tenant-settings/branding')
      return data
    },
  })
}

export function useUpdateBranding() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async (branding: UpdateBrandingRequest) => {
      const { data } = await api.patch<Tenant>('/tenant-settings/branding', branding)
      return data
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['tenant-branding'] })
    },
  })
}

export function useLogoUploadUrl() {
  return useMutation({
    mutationFn: async (request: LogoUploadUrlRequest) => {
      const { data } = await api.post<LogoUploadUrlResponse>(
        '/tenant-settings/logo/upload-url',
        request
      )
      return data
    },
  })
}

export function useLogoConfirm() {
  const queryClient = useQueryClient()
  return useMutation({
    mutationFn: async (request: LogoConfirmRequest) => {
      const { data } = await api.post<Tenant>('/tenant-settings/logo/confirm', request)
      return data
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['tenant-branding'] })
    },
  })
}
```

4. Create frontend/src/features/tenant/index.ts barrel export:
```typescript
export * from './types'
export * from './api'
export { useTenantStore } from './store'
export { useTheme } from './hooks/useTheme'
```
  </action>
  <verify>npm run type-check should pass</verify>
  <done>Tenant feature structure with types and API hooks exists</done>
</task>

<task type="auto">
  <name>Task 2: Create tenant store and theme hook</name>
  <files>frontend/src/features/tenant/store.ts, frontend/src/features/tenant/hooks/useTheme.ts, frontend/src/index.css</files>
  <action>
1. Create frontend/src/features/tenant/store.ts:
```typescript
import { create } from 'zustand'
import type { Tenant } from './types'

interface TenantState {
  branding: Tenant | null
  isLoading: boolean
  setBranding: (branding: Tenant) => void
  clearBranding: () => void
}

export const useTenantStore = create<TenantState>((set) => ({
  branding: null,
  isLoading: false,
  setBranding: (branding) => set({ branding, isLoading: false }),
  clearBranding: () => set({ branding: null }),
}))
```

2. Create frontend/src/features/tenant/hooks directory and useTheme.ts:
```typescript
import { useEffect } from 'react'
import { useTenantStore } from '../store'

// Default brand colors if tenant hasn't configured any
const DEFAULT_COLORS = {
  primary: '#3B82F6',    // Blue-500
  secondary: '#6366F1',  // Indigo-500
  accent: '#10B981',     // Emerald-500
}

export function useTheme() {
  const { branding } = useTenantStore()

  useEffect(() => {
    const root = document.documentElement

    // Apply brand colors as CSS variables
    root.style.setProperty(
      '--color-brand-primary',
      branding?.brand_color_primary || DEFAULT_COLORS.primary
    )
    root.style.setProperty(
      '--color-brand-secondary',
      branding?.brand_color_secondary || DEFAULT_COLORS.secondary
    )
    root.style.setProperty(
      '--color-brand-accent',
      branding?.brand_color_accent || DEFAULT_COLORS.accent
    )
  }, [branding])
}
```

3. Update frontend/src/index.css to add CSS variable definitions at the top (after @import "tailwindcss"):
```css
:root {
  --color-brand-primary: #3B82F6;
  --color-brand-secondary: #6366F1;
  --color-brand-accent: #10B981;
}
```

Note: Tailwind CSS v4 with Vite plugin is already configured. The CSS variables can be used directly in Tailwind classes via arbitrary values like `bg-[var(--color-brand-primary)]` or by extending the theme in the CSS file.
  </action>
  <verify>npm run type-check should pass</verify>
  <done>Tenant store and theme hook exist with CSS variable integration</done>
</task>

<task type="auto">
  <name>Task 3: Create tenant management components (superadmin)</name>
  <files>frontend/src/features/tenant/components/TenantList.tsx, frontend/src/features/tenant/components/CreateTenantModal.tsx, frontend/src/features/tenant/components/index.ts, frontend/src/pages/TenantsPage.tsx</files>
  <action>
1. Create frontend/src/features/tenant/components/TenantList.tsx:
```typescript
import { useState } from 'react'
import { Building2, ToggleLeft, ToggleRight } from 'lucide-react'
import { useTenants, useUpdateTenant } from '../api'
import type { Tenant } from '../types'

export function TenantList() {
  const [showInactive, setShowInactive] = useState(false)
  const { data, isLoading, error } = useTenants(showInactive)
  const updateTenant = useUpdateTenant()

  const handleToggleActive = (tenant: Tenant) => {
    updateTenant.mutate({
      id: tenant.id,
      is_active: !tenant.is_active,
    })
  }

  if (isLoading) {
    return <div className="text-gray-500">Carregando tenants...</div>
  }

  if (error) {
    return <div className="text-red-500">Erro ao carregar tenants</div>
  }

  return (
    <div>
      <div className="mb-4 flex items-center gap-2">
        <label className="flex items-center gap-2 text-sm text-gray-600">
          <input
            type="checkbox"
            checked={showInactive}
            onChange={(e) => setShowInactive(e.target.checked)}
            className="rounded border-gray-300"
          />
          Mostrar inativos
        </label>
      </div>

      <div className="overflow-hidden rounded-lg border border-gray-200">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            <tr>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">
                Tenant
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">
                Slug
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">
                Status
              </th>
              <th className="px-6 py-3 text-left text-xs font-medium uppercase text-gray-500">
                Acoes
              </th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200 bg-white">
            {data?.tenants.map((tenant) => (
              <tr key={tenant.id}>
                <td className="whitespace-nowrap px-6 py-4">
                  <div className="flex items-center gap-3">
                    <Building2 className="h-5 w-5 text-gray-400" />
                    <span className="font-medium text-gray-900">{tenant.name}</span>
                  </div>
                </td>
                <td className="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                  {tenant.slug}
                </td>
                <td className="whitespace-nowrap px-6 py-4">
                  <span
                    className={`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${
                      tenant.is_active
                        ? 'bg-green-100 text-green-800'
                        : 'bg-gray-100 text-gray-800'
                    }`}
                  >
                    {tenant.is_active ? 'Ativo' : 'Inativo'}
                  </span>
                </td>
                <td className="whitespace-nowrap px-6 py-4">
                  <button
                    onClick={() => handleToggleActive(tenant)}
                    disabled={updateTenant.isPending}
                    className="flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900"
                  >
                    {tenant.is_active ? (
                      <>
                        <ToggleRight className="h-4 w-4" />
                        Desativar
                      </>
                    ) : (
                      <>
                        <ToggleLeft className="h-4 w-4" />
                        Ativar
                      </>
                    )}
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <div className="mt-4 text-sm text-gray-500">
        Total: {data?.total ?? 0} tenant(s)
      </div>
    </div>
  )
}
```

2. Create frontend/src/features/tenant/components/CreateTenantModal.tsx:
```typescript
import { useState } from 'react'
import { X } from 'lucide-react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { useCreateTenant } from '../api'

const schema = z.object({
  name: z.string().min(2, 'Nome deve ter pelo menos 2 caracteres'),
  slug: z
    .string()
    .min(2, 'Slug deve ter pelo menos 2 caracteres')
    .regex(/^[a-z0-9-]+$/, 'Slug deve conter apenas letras minusculas, numeros e hifens'),
})

type FormData = z.infer<typeof schema>

interface Props {
  isOpen: boolean
  onClose: () => void
}

export function CreateTenantModal({ isOpen, onClose }: Props) {
  const createTenant = useCreateTenant()
  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<FormData>({
    resolver: zodResolver(schema),
  })

  const onSubmit = async (data: FormData) => {
    try {
      await createTenant.mutateAsync(data)
      reset()
      onClose()
    } catch (error) {
      // Error handled by React Query
    }
  }

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      <div className="fixed inset-0 bg-black/50" onClick={onClose} />
      <div className="relative w-full max-w-md rounded-lg bg-white p-6 shadow-xl">
        <div className="mb-4 flex items-center justify-between">
          <h2 className="text-lg font-semibold">Novo Tenant</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="h-5 w-5" />
          </button>
        </div>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">
              Nome
            </label>
            <input
              {...register('name')}
              className="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2"
              placeholder="Nome da empresa"
            />
            {errors.name && (
              <p className="mt-1 text-sm text-red-500">{errors.name.message}</p>
            )}
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700">
              Slug
            </label>
            <input
              {...register('slug')}
              className="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2"
              placeholder="nome-da-empresa"
            />
            {errors.slug && (
              <p className="mt-1 text-sm text-red-500">{errors.slug.message}</p>
            )}
            <p className="mt-1 text-xs text-gray-500">
              Identificador unico. Apenas letras minusculas, numeros e hifens.
            </p>
          </div>

          <div className="flex justify-end gap-3">
            <button
              type="button"
              onClick={onClose}
              className="rounded-lg px-4 py-2 text-gray-600 hover:bg-gray-100"
            >
              Cancelar
            </button>
            <button
              type="submit"
              disabled={createTenant.isPending}
              className="rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50"
            >
              {createTenant.isPending ? 'Criando...' : 'Criar'}
            </button>
          </div>

          {createTenant.error && (
            <p className="text-sm text-red-500">
              {(createTenant.error as Error).message || 'Erro ao criar tenant'}
            </p>
          )}
        </form>
      </div>
    </div>
  )
}
```

3. Create frontend/src/features/tenant/components/index.ts:
```typescript
export { TenantList } from './TenantList'
export { CreateTenantModal } from './CreateTenantModal'
export { TenantSettingsForm } from './TenantSettingsForm'
export { LogoUploader } from './LogoUploader'
export { ColorPicker } from './ColorPicker'
```

4. Create frontend/src/pages/TenantsPage.tsx:
```typescript
import { useState } from 'react'
import { Plus } from 'lucide-react'
import { TenantList, CreateTenantModal } from '@/features/tenant/components'

export function TenantsPage() {
  const [isModalOpen, setIsModalOpen] = useState(false)

  return (
    <div>
      <div className="mb-6 flex items-center justify-between">
        <h1 className="text-2xl font-bold text-gray-900">Tenants</h1>
        <button
          onClick={() => setIsModalOpen(true)}
          className="flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700"
        >
          <Plus className="h-4 w-4" />
          Novo Tenant
        </button>
      </div>

      <TenantList />

      <CreateTenantModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
      />
    </div>
  )
}
```
  </action>
  <verify>npm run type-check should pass</verify>
  <done>Tenant management components exist for superadmin</done>
</task>

<task type="auto">
  <name>Task 4: Create tenant settings components (admin)</name>
  <files>frontend/src/features/tenant/components/ColorPicker.tsx, frontend/src/features/tenant/components/LogoUploader.tsx, frontend/src/features/tenant/components/TenantSettingsForm.tsx, frontend/src/pages/TenantSettingsPage.tsx</files>
  <action>
1. Create frontend/src/features/tenant/components/ColorPicker.tsx:
```typescript
import { useState } from 'react'
import { HexColorPicker } from 'react-colorful'

interface Props {
  label: string
  value: string | null
  onChange: (color: string) => void
}

export function ColorPicker({ label, value, onChange }: Props) {
  const [isOpen, setIsOpen] = useState(false)
  const currentColor = value || '#3B82F6'

  return (
    <div>
      <label className="block text-sm font-medium text-gray-700">{label}</label>
      <div className="mt-1 flex items-center gap-3">
        <button
          type="button"
          onClick={() => setIsOpen(!isOpen)}
          className="h-10 w-10 rounded border-2 border-gray-300 shadow-sm"
          style={{ backgroundColor: currentColor }}
          aria-label={`Selecionar ${label.toLowerCase()}`}
        />
        <span className="text-sm text-gray-600 font-mono">{currentColor}</span>
      </div>

      {isOpen && (
        <div className="mt-2">
          <HexColorPicker color={currentColor} onChange={onChange} />
          <button
            type="button"
            onClick={() => setIsOpen(false)}
            className="mt-2 text-sm text-gray-500 hover:text-gray-700"
          >
            Fechar
          </button>
        </div>
      )}
    </div>
  )
}
```

2. Create frontend/src/features/tenant/components/LogoUploader.tsx:
```typescript
import { useRef, useState } from 'react'
import { Upload, X, Image } from 'lucide-react'
import { useLogoUploadUrl, useLogoConfirm } from '../api'

interface Props {
  label: string
  logoType: 'primary' | 'secondary'
  currentKey: string | null
  onUploadComplete: () => void
}

export function LogoUploader({ label, logoType, currentKey, onUploadComplete }: Props) {
  const inputRef = useRef<HTMLInputElement>(null)
  const [isUploading, setIsUploading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const getUploadUrl = useLogoUploadUrl()
  const confirmUpload = useLogoConfirm()

  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    // Validate file type
    const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/svg+xml', 'image/webp']
    if (!allowedTypes.includes(file.type)) {
      setError('Formato invalido. Use PNG, JPG, SVG ou WebP.')
      return
    }

    // Validate file size (max 5MB)
    if (file.size > 5 * 1024 * 1024) {
      setError('Arquivo muito grande. Maximo 5MB.')
      return
    }

    setError(null)
    setIsUploading(true)

    try {
      // Get presigned URL
      const { upload_url, object_key } = await getUploadUrl.mutateAsync({
        logo_type: logoType,
        filename: file.name,
      })

      // Upload to R2
      const response = await fetch(upload_url, {
        method: 'PUT',
        body: file,
        headers: {
          'Content-Type': file.type,
        },
      })

      if (!response.ok) {
        throw new Error('Falha no upload')
      }

      // Confirm upload
      await confirmUpload.mutateAsync({
        logo_type: logoType,
        object_key,
      })

      onUploadComplete()
    } catch (err) {
      setError('Erro ao enviar logo')
    } finally {
      setIsUploading(false)
      if (inputRef.current) {
        inputRef.current.value = ''
      }
    }
  }

  return (
    <div>
      <label className="block text-sm font-medium text-gray-700">{label}</label>
      <div className="mt-2 flex items-center gap-4">
        <div className="flex h-20 w-20 items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50">
          {currentKey ? (
            <Image className="h-8 w-8 text-gray-400" />
          ) : (
            <Upload className="h-8 w-8 text-gray-400" />
          )}
        </div>
        <div>
          <input
            ref={inputRef}
            type="file"
            accept="image/png,image/jpeg,image/svg+xml,image/webp"
            onChange={handleFileSelect}
            className="hidden"
          />
          <button
            type="button"
            onClick={() => inputRef.current?.click()}
            disabled={isUploading}
            className="rounded-lg border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50"
          >
            {isUploading ? 'Enviando...' : currentKey ? 'Alterar' : 'Selecionar'}
          </button>
          {currentKey && (
            <p className="mt-1 text-xs text-green-600">Logo configurada</p>
          )}
        </div>
      </div>
      {error && <p className="mt-1 text-sm text-red-500">{error}</p>}
    </div>
  )
}
```

3. Create frontend/src/features/tenant/components/TenantSettingsForm.tsx:
```typescript
import { useEffect } from 'react'
import { useForm } from 'react-hook-form'
import { useTenantBranding, useUpdateBranding } from '../api'
import { useTenantStore } from '../store'
import { ColorPicker } from './ColorPicker'
import { LogoUploader } from './LogoUploader'
import type { UpdateBrandingRequest } from '../types'

export function TenantSettingsForm() {
  const { data: branding, isLoading, refetch } = useTenantBranding()
  const updateBranding = useUpdateBranding()
  const { setBranding } = useTenantStore()

  const { register, handleSubmit, setValue, watch } = useForm<UpdateBrandingRequest>()

  // Sync branding to store when loaded
  useEffect(() => {
    if (branding) {
      setBranding(branding)
    }
  }, [branding, setBranding])

  // Set form values when branding loads
  useEffect(() => {
    if (branding) {
      setValue('brand_color_primary', branding.brand_color_primary)
      setValue('brand_color_secondary', branding.brand_color_secondary)
      setValue('brand_color_accent', branding.brand_color_accent)
      setValue('contact_address', branding.contact_address)
      setValue('contact_phone', branding.contact_phone)
      setValue('contact_email', branding.contact_email)
      setValue('contact_website', branding.contact_website)
    }
  }, [branding, setValue])

  const onSubmit = async (data: UpdateBrandingRequest) => {
    await updateBranding.mutateAsync(data)
  }

  if (isLoading) {
    return <div className="text-gray-500">Carregando...</div>
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
      {/* Logos */}
      <section>
        <h2 className="mb-4 text-lg font-semibold text-gray-900">Logos</h2>
        <div className="grid gap-6 md:grid-cols-2">
          <LogoUploader
            label="Logo Primaria"
            logoType="primary"
            currentKey={branding?.logo_primary_key ?? null}
            onUploadComplete={refetch}
          />
          <LogoUploader
            label="Logo Secundaria"
            logoType="secondary"
            currentKey={branding?.logo_secondary_key ?? null}
            onUploadComplete={refetch}
          />
        </div>
      </section>

      {/* Colors */}
      <section>
        <h2 className="mb-4 text-lg font-semibold text-gray-900">Cores da Marca</h2>
        <div className="grid gap-6 md:grid-cols-3">
          <ColorPicker
            label="Cor Primaria"
            value={watch('brand_color_primary') ?? null}
            onChange={(color) => setValue('brand_color_primary', color)}
          />
          <ColorPicker
            label="Cor Secundaria"
            value={watch('brand_color_secondary') ?? null}
            onChange={(color) => setValue('brand_color_secondary', color)}
          />
          <ColorPicker
            label="Cor de Destaque"
            value={watch('brand_color_accent') ?? null}
            onChange={(color) => setValue('brand_color_accent', color)}
          />
        </div>
      </section>

      {/* Contact Info */}
      <section>
        <h2 className="mb-4 text-lg font-semibold text-gray-900">Informacoes de Contato</h2>
        <div className="grid gap-4 md:grid-cols-2">
          <div>
            <label className="block text-sm font-medium text-gray-700">Endereco</label>
            <input
              {...register('contact_address')}
              className="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2"
              placeholder="Rua, numero, cidade, estado"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Telefone</label>
            <input
              {...register('contact_phone')}
              className="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2"
              placeholder="(11) 99999-9999"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Email</label>
            <input
              {...register('contact_email')}
              type="email"
              className="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2"
              placeholder="contato@empresa.com"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Website</label>
            <input
              {...register('contact_website')}
              className="mt-1 w-full rounded-lg border border-gray-300 px-3 py-2"
              placeholder="https://www.empresa.com"
            />
          </div>
        </div>
      </section>

      {/* Submit */}
      <div className="flex justify-end">
        <button
          type="submit"
          disabled={updateBranding.isPending}
          className="rounded-lg bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50"
        >
          {updateBranding.isPending ? 'Salvando...' : 'Salvar Alteracoes'}
        </button>
      </div>

      {updateBranding.isSuccess && (
        <p className="text-sm text-green-600">Alteracoes salvas com sucesso!</p>
      )}
    </form>
  )
}
```

4. Create frontend/src/pages/TenantSettingsPage.tsx:
```typescript
import { Settings } from 'lucide-react'
import { TenantSettingsForm } from '@/features/tenant/components'

export function TenantSettingsPage() {
  return (
    <div>
      <div className="mb-6 flex items-center gap-3">
        <Settings className="h-6 w-6 text-gray-600" />
        <h1 className="text-2xl font-bold text-gray-900">Configuracoes do Tenant</h1>
      </div>

      <div className="rounded-lg border border-gray-200 bg-white p-6">
        <TenantSettingsForm />
      </div>
    </div>
  )
}
```
  </action>
  <verify>npm run type-check should pass</verify>
  <done>Tenant settings components exist for admin branding configuration</done>
</task>

<task type="auto">
  <name>Task 5: Add routes and integrate theme hook</name>
  <files>frontend/src/pages/index.ts, frontend/src/App.tsx</files>
  <action>
1. Update frontend/src/pages/index.ts to export new pages:
```typescript
export { LoginPage } from './LoginPage'
export { UnauthorizedPage } from './UnauthorizedPage'
export { UsersPage } from './UsersPage'
export { TenantsPage } from './TenantsPage'
export { TenantSettingsPage } from './TenantSettingsPage'
```

2. Update frontend/src/App.tsx:
   - Import useTheme from tenant feature
   - Import TenantsPage and TenantSettingsPage
   - Call useTheme() in App component before return
   - Add navigation link for Tenants (superadmin only)
   - Add navigation link for Configuracoes (admin only)
   - Add route for /tenants (superadmin only)
   - Add route for /settings (admin and superadmin)

Add to imports:
```typescript
import { useTheme } from '@/features/tenant'
import { TenantsPage, TenantSettingsPage } from '@/pages'
import { Building2, Settings } from 'lucide-react'
```

In AppLayout, add navigation links after Usuarios:
```tsx
{user?.role === 'superadmin' && (
  <Link
    to="/tenants"
    className="flex items-center gap-1 text-gray-600 hover:text-gray-900"
  >
    <Building2 className="h-4 w-4" />
    Tenants
  </Link>
)}
{(user?.role === 'admin' || user?.role === 'superadmin') && (
  <Link
    to="/settings"
    className="flex items-center gap-1 text-gray-600 hover:text-gray-900"
  >
    <Settings className="h-4 w-4" />
    Configuracoes
  </Link>
)}
```

In App component, call useTheme():
```tsx
function App() {
  useTheme()  // Apply tenant branding
  return (...)
}
```

Add routes before the catch-all:
```tsx
<Route
  path="/tenants"
  element={
    <ProtectedRoute allowedRoles={['superadmin']}>
      <AppLayout>
        <TenantsPage />
      </AppLayout>
    </ProtectedRoute>
  }
/>
<Route
  path="/settings"
  element={
    <ProtectedRoute allowedRoles={['admin', 'superadmin']}>
      <AppLayout>
        <TenantSettingsPage />
      </AppLayout>
    </ProtectedRoute>
  }
/>
```
  </action>
  <verify>npm run build should succeed</verify>
  <done>Routes configured and theme hook integrated</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete tenant management and branding UI:
- Superadmin can view and manage tenants at /tenants
- Admin can configure branding at /settings
- Color picker for brand colors
- Logo upload to R2 storage
- Contact information form
- Dynamic CSS variable theming
  </what-built>
  <how-to-verify>
1. Start backend: `cd backend && uvicorn app.main:app --reload`
2. Start frontend: `cd frontend && npm run dev`
3. As superadmin:
   - Navigate to /tenants
   - Verify tenant list loads
   - Create a new tenant
   - Toggle tenant active/inactive
4. As admin:
   - Navigate to /settings
   - Change brand colors using color picker
   - Upload a logo image
   - Fill contact information
   - Save and verify changes persist
5. Verify brand colors apply to app header (if using brand colors in nav)
  </how-to-verify>
  <resume-signal>Type "approved" if all verification passes, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. Run `cd frontend && npm run type-check` - should pass
2. Run `cd frontend && npm run build` - should succeed
3. All pages accessible at correct routes
4. Color picker works and saves colors
5. Logo upload completes without errors
6. Contact form saves and loads data
</verification>

<success_criteria>
- TenantsPage lists tenants for superadmin
- CreateTenantModal creates new tenant with validation
- TenantSettingsPage shows branding form for admin
- ColorPicker allows selecting hex colors
- LogoUploader uploads to R2 and confirms
- CSS variables update when branding changes
- All text is in Portuguese
- Error states display properly
</success_criteria>

<output>
After completion, create `.planning/phases/03-multi-tenant-architecture/03-05-SUMMARY.md`
</output>
