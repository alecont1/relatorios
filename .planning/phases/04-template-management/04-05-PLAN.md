---
phase: 04-template-management
plan: 05
type: execute
wave: 4
depends_on: ["04-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Admin can upload Excel and see preview before saving"
    - "Admin can create template with auto-generated code"
    - "Template appears in list after creation"
    - "Admin can activate/deactivate templates"
    - "Search and filter work correctly"
  artifacts: []
  key_links: []
---

<objective>
Verify complete template management flow end-to-end.

Purpose: Ensure the full workflow works as expected - Excel upload, preview, confirmation, listing, and status management. Human verification confirms UI/UX and functionality.

Output: Verified template management feature ready for use.
</objective>

<execution_context>
@C:\Users\xande\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\xande\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Users\xande\smarthand-reports\.planning\PROJECT.md
@C:\Users\xande\smarthand-reports\.planning\phases\04-template-management\04-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete template management system:
    - Database models for Template, TemplateSection, TemplateField
    - Excel parser service with validation
    - API endpoints: parse, create, list, get, update
    - Frontend UI: list with search/filter, Excel upload, preview modal
  </what-built>
  <how-to-verify>
    1. Start backend: `cd backend && uvicorn app.main:app --reload`
    2. Start frontend: `cd frontend && npm run dev`
    3. Log in as admin user
    4. Navigate to /templates

    **Test 1: Empty State**
    - Verify empty template list shows "Nenhum template encontrado"

    **Test 2: Excel Upload - Valid File**
    - Create a test Excel file with columns: Section, Script Step, Result Type, Step Result Values
    - Add rows like:
      - General | Check power | Drop Down | Yes/No/NA
      - General | Serial number | Text |
      - Electrical | Voltage | Text |
    - Click "Importar Excel" button
    - Drag or select the Excel file
    - Verify preview modal shows:
      - Green "Arquivo valido!" message
      - Section count and field count summary
      - Expandable sections with fields
      - Name input and category dropdown

    **Test 3: Template Creation**
    - Enter a name like "Test Template"
    - Select category (e.g., Commissioning)
    - Click "Confirmar e Criar"
    - Verify template appears in list with:
      - Entered name
      - Auto-generated code (e.g., COM-001)
      - Selected category
      - Version v1
      - Status "Ativo"

    **Test 4: Search and Filter**
    - Type template name in search box
    - Verify instant filtering works
    - Type template code (e.g., COM-001)
    - Verify code search works
    - Change status filter to "Inativos"
    - Verify list is empty (all templates active)

    **Test 5: Status Toggle**
    - Click toggle icon on template row
    - Verify status changes to "Inativo"
    - Change filter to "Todos"
    - Verify inactive template shows with red status badge
    - Toggle again to reactivate

    **Test 6: Excel Upload - Invalid File**
    - Create Excel with missing columns or invalid Result Type
    - Upload the file
    - Verify error modal shows:
      - Red "Encontrados X erro(s)" message
      - List of all errors with row numbers
      - Only "Fechar" button (no confirm)

    **Expected Results:**
    - All tests pass
    - UI is responsive and user-friendly
    - Error messages are in Portuguese
    - No console errors
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Human verification confirms:
1. Template list displays correctly with all columns
2. Search and filter work as expected
3. Excel upload and parsing works
4. Preview modal shows correct data
5. Template creation completes successfully
6. Status toggle works
7. Error handling displays all errors
</verification>

<success_criteria>
- Full template management workflow verified working
- UI/UX meets expectations
- No blocking issues found
- Phase 4 requirements TMPL-01, TMPL-02, TMPL-03, TMPL-05 satisfied
- (TMPL-04 global templates deferred per user decision)
</success_criteria>

<output>
After completion, create `.planning/phases/04-template-management/04-05-SUMMARY.md`
</output>
