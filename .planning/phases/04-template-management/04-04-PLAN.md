---
phase: 04-template-management
plan: 04
type: execute
wave: 3
depends_on: ["04-03"]
files_modified:
  - frontend/package.json
  - frontend/src/features/template/api/templateApi.ts
  - frontend/src/features/template/components/TemplateList.tsx
  - frontend/src/features/template/components/ExcelUploader.tsx
  - frontend/src/features/template/components/TemplatePreviewModal.tsx
  - frontend/src/features/template/components/index.ts
  - frontend/src/features/template/hooks/useDebouncedValue.ts
  - frontend/src/pages/TemplatesPage.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Admin sees template list with name, code, category, status, version columns"
    - "Admin can search templates by name or code (instant filtering)"
    - "Admin can toggle between active/inactive/all status filter"
    - "Admin can drag-drop or click to upload Excel file"
    - "Admin sees preview of parsed sections and fields before confirming"
    - "Admin can confirm and create template from preview"
    - "Error messages display when Excel validation fails"
  artifacts:
    - path: "frontend/src/features/template/components/TemplateList.tsx"
      provides: "Template table with search and filters"
      contains: "TemplateList"
    - path: "frontend/src/features/template/components/ExcelUploader.tsx"
      provides: "Drag-drop file upload component"
      contains: "useDropzone"
    - path: "frontend/src/features/template/components/TemplatePreviewModal.tsx"
      provides: "Preview modal with sections/fields"
      contains: "TemplatePreviewModal"
    - path: "frontend/src/pages/TemplatesPage.tsx"
      provides: "Templates page with list and upload"
      contains: "TemplatesPage"
  key_links:
    - from: "frontend/src/features/template/components/TemplateList.tsx"
      to: "/api/v1/templates"
      via: "useQuery"
      pattern: "useQuery.*templates"
    - from: "frontend/src/features/template/components/ExcelUploader.tsx"
      to: "/api/v1/templates/parse"
      via: "useMutation"
      pattern: "useMutation.*parse"
    - from: "frontend/src/pages/TemplatesPage.tsx"
      to: "frontend/src/App.tsx"
      via: "route registration"
      pattern: "path.*templates"
---

<objective>
Create frontend UI for template management.

Purpose: Admins need to view, search, and create templates via Excel upload. This plan implements the TemplatesPage with a searchable table, Excel upload dropzone, and preview modal for confirming template creation.

Output: Fully functional template management UI accessible at /templates route.
</objective>

<execution_context>
@C:\Users\xande\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\xande\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Users\xande\smarthand-reports\.planning\PROJECT.md
@C:\Users\xande\smarthand-reports\.planning\phases\04-template-management\04-CONTEXT.md
@C:\Users\xande\smarthand-reports\.planning\phases\04-template-management\04-RESEARCH.md

# Existing UI patterns
@C:\Users\xande\smarthand-reports\frontend\src\pages\TenantsPage.tsx
@C:\Users\xande\smarthand-reports\frontend\src\features\tenant\components\TenantList.tsx
@C:\Users\xande\smarthand-reports\frontend\src\App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-dropzone and create template API layer</name>
  <files>
    frontend/package.json
    frontend/src/features/template/api/templateApi.ts
    frontend/src/features/template/hooks/useDebouncedValue.ts
  </files>
  <action>
    **Install react-dropzone:**
    ```bash
    cd frontend && npm install react-dropzone
    ```

    **Create templateApi.ts:**
    ```typescript
    import api from '@/lib/axios'

    export interface TemplateField {
      id?: string
      label: string
      field_type: 'dropdown' | 'text'
      options: string[] | null
      order: number
    }

    export interface TemplateSection {
      id?: string
      name: string
      order: number
      fields: TemplateField[]
    }

    export interface Template {
      id: string
      tenant_id: string
      name: string
      code: string
      category: string
      version: number
      title: string | null
      reference_standards: string | null
      planning_requirements: string | null
      is_active: boolean
      created_at: string
      updated_at: string
      sections?: TemplateSection[]
    }

    export interface TemplateListItem {
      id: string
      name: string
      code: string
      category: string
      version: number
      is_active: boolean
      created_at: string
    }

    export interface TemplateListResponse {
      templates: TemplateListItem[]
      total: number
    }

    export interface ExcelParseResponse {
      valid: boolean
      sections?: TemplateSection[]
      errors?: string[]
      summary?: {
        section_count: number
        field_count: number
      }
    }

    export interface TemplateCreateData {
      name: string
      category: 'Commissioning' | 'Inspection' | 'Maintenance' | 'Testing'
      sections: TemplateSection[]
      title?: string
      reference_standards?: string
      planning_requirements?: string
    }

    export const templateApi = {
      list: async (params: { search?: string; status?: string; skip?: number; limit?: number }) => {
        const response = await api.get<TemplateListResponse>('/templates', { params })
        return response.data
      },

      get: async (id: string) => {
        const response = await api.get<Template>(`/templates/${id}`)
        return response.data
      },

      parse: async (file: File) => {
        const formData = new FormData()
        formData.append('file', file)
        const response = await api.post<ExcelParseResponse>('/templates/parse', formData, {
          headers: { 'Content-Type': 'multipart/form-data' }
        })
        return response.data
      },

      create: async (data: TemplateCreateData) => {
        const response = await api.post<Template>('/templates', data)
        return response.data
      },

      update: async (id: string, data: Partial<TemplateCreateData> & { is_active?: boolean }) => {
        const response = await api.patch<Template>(`/templates/${id}`, data)
        return response.data
      },
    }
    ```

    **Create useDebouncedValue.ts:**
    ```typescript
    import { useState, useEffect } from 'react'

    export function useDebouncedValue<T>(value: T, delay: number = 300): T {
      const [debouncedValue, setDebouncedValue] = useState(value)

      useEffect(() => {
        const timer = setTimeout(() => setDebouncedValue(value), delay)
        return () => clearTimeout(timer)
      }, [value, delay])

      return debouncedValue
    }
    ```
  </action>
  <verify>
    Run: cd C:\Users\xande\smarthand-reports\frontend && npm ls react-dropzone && npx tsc --noEmit
  </verify>
  <done>
    - react-dropzone installed in package.json
    - templateApi.ts exports all API functions with types
    - useDebouncedValue hook created for search input
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TemplateList and ExcelUploader components</name>
  <files>
    frontend/src/features/template/components/TemplateList.tsx
    frontend/src/features/template/components/ExcelUploader.tsx
    frontend/src/features/template/components/index.ts
  </files>
  <action>
    **Create TemplateList.tsx:**
    ```typescript
    import { useState } from 'react'
    import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
    import { Search, ToggleLeft, ToggleRight } from 'lucide-react'
    import { templateApi, TemplateListItem } from '../api/templateApi'
    import { useDebouncedValue } from '../hooks/useDebouncedValue'

    interface TemplateListProps {
      onSelectTemplate?: (template: TemplateListItem) => void
    }

    export function TemplateList({ onSelectTemplate }: TemplateListProps) {
      const [search, setSearch] = useState('')
      const [statusFilter, setStatusFilter] = useState<'active' | 'inactive' | 'all'>('active')
      const debouncedSearch = useDebouncedValue(search, 300)
      const queryClient = useQueryClient()

      const { data, isLoading, error } = useQuery({
        queryKey: ['templates', debouncedSearch, statusFilter],
        queryFn: () => templateApi.list({ search: debouncedSearch, status: statusFilter }),
      })

      const toggleMutation = useMutation({
        mutationFn: ({ id, is_active }: { id: string; is_active: boolean }) =>
          templateApi.update(id, { is_active }),
        onSuccess: () => {
          queryClient.invalidateQueries({ queryKey: ['templates'] })
        },
      })

      const getCategoryBadgeColor = (category: string) => {
        const colors: Record<string, string> = {
          Commissioning: 'bg-blue-100 text-blue-800',
          Inspection: 'bg-green-100 text-green-800',
          Maintenance: 'bg-yellow-100 text-yellow-800',
          Testing: 'bg-purple-100 text-purple-800',
        }
        return colors[category] || 'bg-gray-100 text-gray-800'
      }

      if (error) {
        return <div className="text-red-600">Erro ao carregar templates</div>
      }

      return (
        <div className="space-y-4">
          {/* Search and Filter */}
          <div className="flex gap-4">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" />
              <input
                type="text"
                placeholder="Buscar por nome ou codigo..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
                className="w-full rounded-lg border border-gray-300 py-2 pl-10 pr-4 focus:border-blue-500 focus:outline-none"
              />
            </div>
            <select
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value as 'active' | 'inactive' | 'all')}
              className="rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none"
            >
              <option value="active">Ativos</option>
              <option value="inactive">Inativos</option>
              <option value="all">Todos</option>
            </select>
          </div>

          {/* Table */}
          <div className="overflow-hidden rounded-lg border border-gray-200">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                    Nome
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                    Codigo
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                    Categoria
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                    Versao
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                    Status
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                    Acoes
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200 bg-white">
                {isLoading ? (
                  <tr>
                    <td colSpan={6} className="px-6 py-4 text-center text-gray-500">
                      Carregando...
                    </td>
                  </tr>
                ) : data?.templates.length === 0 ? (
                  <tr>
                    <td colSpan={6} className="px-6 py-4 text-center text-gray-500">
                      Nenhum template encontrado
                    </td>
                  </tr>
                ) : (
                  data?.templates.map((template) => (
                    <tr
                      key={template.id}
                      className="hover:bg-gray-50 cursor-pointer"
                      onClick={() => onSelectTemplate?.(template)}
                    >
                      <td className="whitespace-nowrap px-6 py-4 font-medium text-gray-900">
                        {template.name}
                      </td>
                      <td className="whitespace-nowrap px-6 py-4 font-mono text-sm text-gray-600">
                        {template.code}
                      </td>
                      <td className="whitespace-nowrap px-6 py-4">
                        <span className={`rounded-full px-2 py-1 text-xs font-medium ${getCategoryBadgeColor(template.category)}`}>
                          {template.category}
                        </span>
                      </td>
                      <td className="whitespace-nowrap px-6 py-4 text-gray-600">
                        v{template.version}
                      </td>
                      <td className="whitespace-nowrap px-6 py-4">
                        <span className={`rounded-full px-2 py-1 text-xs font-medium ${
                          template.is_active
                            ? 'bg-green-100 text-green-800'
                            : 'bg-red-100 text-red-800'
                        }`}>
                          {template.is_active ? 'Ativo' : 'Inativo'}
                        </span>
                      </td>
                      <td className="whitespace-nowrap px-6 py-4">
                        <button
                          onClick={(e) => {
                            e.stopPropagation()
                            toggleMutation.mutate({ id: template.id, is_active: !template.is_active })
                          }}
                          className="text-gray-400 hover:text-gray-600"
                          title={template.is_active ? 'Desativar' : 'Ativar'}
                        >
                          {template.is_active ? (
                            <ToggleRight className="h-5 w-5 text-green-600" />
                          ) : (
                            <ToggleLeft className="h-5 w-5 text-gray-400" />
                          )}
                        </button>
                      </td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>

          {/* Total count */}
          {data && (
            <div className="text-sm text-gray-500">
              Total: {data.total} template(s)
            </div>
          )}
        </div>
      )
    }
    ```

    **Create ExcelUploader.tsx:**
    ```typescript
    import { useCallback } from 'react'
    import { useDropzone } from 'react-dropzone'
    import { Upload, FileSpreadsheet, AlertCircle } from 'lucide-react'
    import { useMutation } from '@tanstack/react-query'
    import { templateApi, ExcelParseResponse } from '../api/templateApi'

    interface ExcelUploaderProps {
      onParsed: (result: ExcelParseResponse, file: File) => void
    }

    export function ExcelUploader({ onParsed }: ExcelUploaderProps) {
      const parseMutation = useMutation({
        mutationFn: templateApi.parse,
      })

      const onDrop = useCallback(
        async (acceptedFiles: File[]) => {
          const file = acceptedFiles[0]
          if (!file) return

          const result = await parseMutation.mutateAsync(file)
          onParsed(result, file)
        },
        [parseMutation, onParsed]
      )

      const { getRootProps, getInputProps, isDragActive } = useDropzone({
        onDrop,
        accept: {
          'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],
          'application/vnd.ms-excel': ['.xls'],
        },
        maxFiles: 1,
        disabled: parseMutation.isPending,
      })

      return (
        <div
          {...getRootProps()}
          className={`
            rounded-lg border-2 border-dashed p-8 text-center transition-colors cursor-pointer
            ${isDragActive ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-gray-400'}
            ${parseMutation.isPending ? 'opacity-50 cursor-not-allowed' : ''}
          `}
        >
          <input {...getInputProps()} />

          {parseMutation.isPending ? (
            <div className="flex flex-col items-center gap-2">
              <div className="h-8 w-8 animate-spin rounded-full border-2 border-blue-500 border-t-transparent" />
              <p className="text-gray-600">Processando arquivo...</p>
            </div>
          ) : parseMutation.isError ? (
            <div className="flex flex-col items-center gap-2 text-red-600">
              <AlertCircle className="h-8 w-8" />
              <p>Erro ao processar arquivo</p>
              <p className="text-sm">Clique para tentar novamente</p>
            </div>
          ) : (
            <div className="flex flex-col items-center gap-2">
              {isDragActive ? (
                <>
                  <FileSpreadsheet className="h-8 w-8 text-blue-500" />
                  <p className="text-blue-600">Solte o arquivo aqui...</p>
                </>
              ) : (
                <>
                  <Upload className="h-8 w-8 text-gray-400" />
                  <p className="text-gray-600">
                    Arraste um arquivo Excel ou clique para selecionar
                  </p>
                  <p className="text-sm text-gray-400">
                    Formatos aceitos: .xlsx, .xls
                  </p>
                </>
              )}
            </div>
          )}
        </div>
      )
    }
    ```

    **Create index.ts:**
    ```typescript
    export { TemplateList } from './TemplateList'
    export { ExcelUploader } from './ExcelUploader'
    export { TemplatePreviewModal } from './TemplatePreviewModal'
    ```
  </action>
  <verify>
    Run: cd C:\Users\xande\smarthand-reports\frontend && npx tsc --noEmit
  </verify>
  <done>
    - TemplateList shows table with name, code, category, version, status columns
    - TemplateList has search input with debounced filtering
    - TemplateList has status dropdown (active/inactive/all)
    - ExcelUploader uses react-dropzone for drag-drop upload
    - ExcelUploader calls parse API and returns result to parent
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Create TemplatePreviewModal and TemplatesPage</name>
  <files>
    frontend/src/features/template/components/TemplatePreviewModal.tsx
    frontend/src/pages/TemplatesPage.tsx
    frontend/src/App.tsx
  </files>
  <action>
    **Create TemplatePreviewModal.tsx:**
    ```typescript
    import { useState } from 'react'
    import { X, Check, AlertTriangle, ChevronDown, ChevronRight } from 'lucide-react'
    import { useMutation, useQueryClient } from '@tanstack/react-query'
    import { templateApi, TemplateSection, TemplateCreateData } from '../api/templateApi'

    interface TemplatePreviewModalProps {
      isOpen: boolean
      onClose: () => void
      sections: TemplateSection[]
      errors?: string[]
      summary?: { section_count: number; field_count: number }
    }

    const CATEGORIES = ['Commissioning', 'Inspection', 'Maintenance', 'Testing'] as const

    export function TemplatePreviewModal({
      isOpen,
      onClose,
      sections,
      errors,
      summary,
    }: TemplatePreviewModalProps) {
      const [name, setName] = useState('')
      const [category, setCategory] = useState<typeof CATEGORIES[number]>('Commissioning')
      const [expandedSections, setExpandedSections] = useState<Set<number>>(new Set([0]))
      const queryClient = useQueryClient()

      const createMutation = useMutation({
        mutationFn: templateApi.create,
        onSuccess: () => {
          queryClient.invalidateQueries({ queryKey: ['templates'] })
          onClose()
          setName('')
        },
      })

      const toggleSection = (index: number) => {
        setExpandedSections((prev) => {
          const next = new Set(prev)
          if (next.has(index)) {
            next.delete(index)
          } else {
            next.add(index)
          }
          return next
        })
      }

      const handleConfirm = () => {
        if (!name.trim()) return

        const data: TemplateCreateData = {
          name: name.trim(),
          category,
          sections: sections.map((s, i) => ({
            name: s.name,
            order: i,
            fields: s.fields.map((f, j) => ({
              label: f.label,
              field_type: f.field_type,
              options: f.options,
              order: j,
            })),
          })),
        }

        createMutation.mutate(data)
      }

      if (!isOpen) return null

      const hasErrors = errors && errors.length > 0

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
          <div className="max-h-[90vh] w-full max-w-2xl overflow-hidden rounded-lg bg-white shadow-xl">
            {/* Header */}
            <div className="flex items-center justify-between border-b px-6 py-4">
              <h2 className="text-lg font-semibold">
                {hasErrors ? 'Erros de Validacao' : 'Preview do Template'}
              </h2>
              <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                <X className="h-5 w-5" />
              </button>
            </div>

            {/* Content */}
            <div className="max-h-[60vh] overflow-y-auto p-6">
              {hasErrors ? (
                <div className="space-y-2">
                  <div className="flex items-center gap-2 text-red-600">
                    <AlertTriangle className="h-5 w-5" />
                    <span className="font-medium">
                      Encontrados {errors.length} erro(s) no arquivo
                    </span>
                  </div>
                  <ul className="ml-7 list-disc space-y-1 text-sm text-red-600">
                    {errors.map((error, i) => (
                      <li key={i}>{error}</li>
                    ))}
                  </ul>
                </div>
              ) : (
                <div className="space-y-4">
                  {/* Summary */}
                  {summary && (
                    <div className="rounded-lg bg-green-50 p-4 text-green-800">
                      <div className="flex items-center gap-2">
                        <Check className="h-5 w-5" />
                        <span className="font-medium">Arquivo valido!</span>
                      </div>
                      <p className="mt-1 text-sm">
                        {summary.section_count} secao(oes) com {summary.field_count} campo(s)
                      </p>
                    </div>
                  )}

                  {/* Template metadata */}
                  <div className="space-y-3">
                    <div>
                      <label className="mb-1 block text-sm font-medium text-gray-700">
                        Nome do Template *
                      </label>
                      <input
                        type="text"
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                        placeholder="Ex: Commissioning Report v1"
                        className="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none"
                      />
                    </div>
                    <div>
                      <label className="mb-1 block text-sm font-medium text-gray-700">
                        Categoria *
                      </label>
                      <select
                        value={category}
                        onChange={(e) => setCategory(e.target.value as typeof category)}
                        className="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none"
                      >
                        {CATEGORIES.map((cat) => (
                          <option key={cat} value={cat}>
                            {cat}
                          </option>
                        ))}
                      </select>
                    </div>
                  </div>

                  {/* Sections preview */}
                  <div className="space-y-2">
                    <h3 className="font-medium text-gray-700">Secoes e Campos</h3>
                    {sections.map((section, sectionIndex) => (
                      <div key={sectionIndex} className="rounded border border-gray-200">
                        <button
                          onClick={() => toggleSection(sectionIndex)}
                          className="flex w-full items-center justify-between px-4 py-2 hover:bg-gray-50"
                        >
                          <span className="font-medium">{section.name}</span>
                          <div className="flex items-center gap-2">
                            <span className="text-sm text-gray-500">
                              {section.fields.length} campo(s)
                            </span>
                            {expandedSections.has(sectionIndex) ? (
                              <ChevronDown className="h-4 w-4" />
                            ) : (
                              <ChevronRight className="h-4 w-4" />
                            )}
                          </div>
                        </button>
                        {expandedSections.has(sectionIndex) && (
                          <div className="border-t bg-gray-50 px-4 py-2">
                            <ul className="space-y-1 text-sm">
                              {section.fields.map((field, fieldIndex) => (
                                <li key={fieldIndex} className="flex items-center gap-2">
                                  <span className="text-gray-600">{field.label}</span>
                                  <span className={`rounded px-1.5 py-0.5 text-xs ${
                                    field.field_type === 'dropdown'
                                      ? 'bg-blue-100 text-blue-700'
                                      : 'bg-gray-100 text-gray-700'
                                  }`}>
                                    {field.field_type}
                                  </span>
                                  {field.options && (
                                    <span className="text-xs text-gray-400">
                                      ({field.options.join(', ')})
                                    </span>
                                  )}
                                </li>
                              ))}
                            </ul>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* Footer */}
            <div className="flex justify-end gap-3 border-t px-6 py-4">
              <button
                onClick={onClose}
                className="rounded-lg border border-gray-300 px-4 py-2 hover:bg-gray-50"
              >
                {hasErrors ? 'Fechar' : 'Cancelar'}
              </button>
              {!hasErrors && (
                <button
                  onClick={handleConfirm}
                  disabled={!name.trim() || createMutation.isPending}
                  className="flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50"
                >
                  {createMutation.isPending ? (
                    <>
                      <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
                      Salvando...
                    </>
                  ) : (
                    <>
                      <Check className="h-4 w-4" />
                      Confirmar e Criar
                    </>
                  )}
                </button>
              )}
            </div>
          </div>
        </div>
      )
    }
    ```

    **Create TemplatesPage.tsx:**
    ```typescript
    import { useState } from 'react'
    import { Upload } from 'lucide-react'
    import { TemplateList, ExcelUploader, TemplatePreviewModal } from '@/features/template/components'
    import { ExcelParseResponse, TemplateSection } from '@/features/template/api/templateApi'

    export function TemplatesPage() {
      const [showUploader, setShowUploader] = useState(false)
      const [previewData, setPreviewData] = useState<{
        sections: TemplateSection[]
        errors?: string[]
        summary?: { section_count: number; field_count: number }
      } | null>(null)

      const handleParsed = (result: ExcelParseResponse) => {
        if (result.valid && result.sections) {
          setPreviewData({
            sections: result.sections,
            summary: result.summary,
          })
        } else {
          setPreviewData({
            sections: [],
            errors: result.errors,
          })
        }
        setShowUploader(false)
      }

      const handleClosePreview = () => {
        setPreviewData(null)
      }

      return (
        <div>
          <div className="mb-6 flex items-center justify-between">
            <h1 className="text-2xl font-bold text-gray-900">Templates</h1>
            <button
              onClick={() => setShowUploader(!showUploader)}
              className="flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700"
            >
              <Upload className="h-4 w-4" />
              Importar Excel
            </button>
          </div>

          {showUploader && (
            <div className="mb-6">
              <ExcelUploader onParsed={handleParsed} />
            </div>
          )}

          <TemplateList />

          {previewData && (
            <TemplatePreviewModal
              isOpen={true}
              onClose={handleClosePreview}
              sections={previewData.sections}
              errors={previewData.errors}
              summary={previewData.summary}
            />
          )}
        </div>
      )
    }
    ```

    **Update App.tsx:**
    Add route for templates page. Import TemplatesPage and add route like:
    ```typescript
    import { TemplatesPage } from '@/pages/TemplatesPage'

    // In routes array, add:
    <Route
      path="/templates"
      element={
        <ProtectedRoute allowedRoles={['admin', 'superadmin']}>
          <TemplatesPage />
        </ProtectedRoute>
      }
    />
    ```
  </action>
  <verify>
    Run: cd C:\Users\xande\smarthand-reports\frontend && npx tsc --noEmit && npm run build
  </verify>
  <done>
    - TemplatePreviewModal shows parsed sections/fields or error list
    - TemplatePreviewModal has name and category inputs
    - TemplatePreviewModal confirms and creates template
    - TemplatesPage combines list, uploader, and preview modal
    - /templates route added to App.tsx with admin protection
    - Build completes without errors
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. npm run build succeeds
2. /templates route accessible for admin users
3. Template list shows with search and status filter
4. Excel upload shows drag-drop zone
5. Valid Excel shows preview modal with sections
6. Invalid Excel shows error messages
7. Confirm creates template and refreshes list
</verification>

<success_criteria>
- Template management UI accessible at /templates
- TemplateList shows name, code, category, version, status columns
- Search filters by name or code (debounced)
- Status filter shows active/inactive/all options
- ExcelUploader accepts drag-drop Excel files
- Preview modal shows parsed sections with expandable fields
- Error modal shows all validation errors from parser
- Confirm creates template with auto-generated code
- Only admin+ roles can access page
</success_criteria>

<output>
After completion, create `.planning/phases/04-template-management/04-04-SUMMARY.md`
</output>
